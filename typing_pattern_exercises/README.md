# Typing Common Pattern Exercises

This directory contains exercises related to section 4 of the tutorial. 

Every Python file under this directory is a small, self-contained exercise. You can either type check them locally by `cd` into the relevant directory and run `pyre check` to verify your answers, e.g.
```
$ cd topic1/union/
$ pyre check
```

Or you can click the links on this page which brings you to the online playground, and do the exercises there. 

## Topic 1: Working with values of different types

### Union Type
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%0Adef+_receive_bytes_data%28%29+-%3E+bytes%3A%0A++++...%0A%0A%0A%23+TODO%3A+This+is+a+function+that%27s+intended+to+receive+data+from+the+network.%0A%23+Try+add+type+annotation+to+it+using+union+type.+This+entire+file+should+type%0A%23+check+if+you+annotate+it+correctly.%0Adef+receive_data%28encoding%3DNone%29%3A%0A++++bytes_data+%3D+_receive_bytes_data%28%29%0A++++if+encoding+is+None%3A%0A++++++++return+bytes_data%0A++++else%3A%0A++++++++return+bytes_data.decode%28encoding%29%0A%0A%0A%23+Code+below+are+used+to+verify+if+your+annotated+the+above+function+correctly.%0Adef+_process_bytes%28data%3A+bytes%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+_process_string%28data%3A+str%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test%28%29+-%3E+None%3A%0A++++received_bytes+%3D+receive_data%28%29%0A++++if+isinstance%28received_bytes%2C+bytes%29%3A%0A++++++++_process_bytes%28received_bytes%29%0A%0A++++received_string+%3D+receive_data%28%22utf-8%22%29%0A++++if+isinstance%28received_string%2C+str%29%3A%0A++++++++_process_string%28received_string%29%0A%0A%0A%23+Note+the+two+isinstance%28%29+check+in+our+test%28%29+function+--+why+do+you+think%0A%23+they+exist%3F+What+happens+if+we+removed+them%3F%0A)
- [Example1](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0Aimport+pathlib%0A%0A%23+Here+is+a+simple+function+that+takes+a+file+path+and+return+its+content.%0A%23+TODO%3A+Try+add+type+annotations+to+this+function.%0Adef+read_file%28path%29%3A%0A++++try%3A%0A++++++++%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fpathlib.html%23pathlib.Path.read_text%0A++++++++return+path.read_text%28%29%0A++++except+%28FileNotFoundError%2C+PermissionError%29+as+error%3A%0A++++++++return+None%0A%0A%0A%23+Here+is+an+alternative+implementation+that+lets+the+exceptions+escape.+%0A%23+TODO%3A+Try+type+annotating+this+one+as+well.%0Adef+read_file_alternative%28path%29%3A%0A++++%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fpathlib.html%23pathlib.Path.read_text%0A++++return+path.read_text%28%29%0A%0A%0A%23+Question%3A+Compare+the+two+functions+above.+Which+one+is+more+convenient+to%0A%23+use%3F+Which+one+is+safer+to+use%3F%0Adef+_process_content%28data%3A+str%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test%28path%3A+pathlib.Path%29+-%3E+None%3A%0A++++file_content+%3D+read_file%28path%29%0A++++if+file_content+is+not+None%3A++%23+what+happens+if+we+remove+this+line%3F%0A++++++++_process_content%28file_content%29%0A%0A++++file_content2+%3D+read_file_alternative%28path%29%0A++++_process_content%28file_content2%29%0A
) (Non-live)
- [Example2](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+We+mentioned+in+the+talk+that+consuming+values+of+union+type+often+requires+a%0A%23+case+split.+But+there+are+also+cases+where+the+case+split+is+not+necessary.%0A%23+This+example+demonstrates+those+cases.%0A%0A%23+Consider+these+two+classes%3A%0A%0A%0Aclass+Dog%3A%0A++++def+bark%28self%29+-%3E+None%3A%0A++++++++print%28%22Whoof%21+Whoof%21%22%29%0A%0A++++def+play%28self%29+-%3E+None%3A%0A++++++++print%28%22Dog+playing%21%22%29%0A%0A++++def+chase%28self%2C+dog%3A+Dog%29+-%3E+None%3A%0A++++++++print%28%22Dog+is+chasing+another+dog%21%22%29%0A%0A%0Aclass+Cat%3A%0A++++def+meow%28self%29+-%3E+None%3A%0A++++++++print%28%22Meow%21+Meow%21%22%29%0A%0A++++def+play%28self%29+-%3E+None%3A%0A++++++++print%28%22Cat+playing%21%22%29%0A%0A++++def+chase%28self%2C+cat%3A+Cat%29+-%3E+None%3A%0A++++++++print%28%22Cat+is+chasing+another+cat%21%22%29%0A%0A%0A%23+Now+we+have+a+function+written+like+this%3A%0A%0A%0Adef+make_sound%28pet%29%3A%0A++++if+isinstance%28pet%2C+Dog%29%3A%0A++++++++pet.bark%28%29%0A++++elif+isinstance%28pet%2C+Cat%29%3A%0A++++++++pet.meow%28%29%0A++++else%3A%0A++++++++raise+RuntimeError%0A%0A%0Amake_sound%28Dog%28%29%29%0Amake_sound%28Cat%28%29%29%0A%0A%23+TODO%3A+Type-annotate+the+%60make_sound%60+function.+Is+the+case-split+here%0A%23+necessary+or+not%3F%0A%0A%0A%23+------------------------------------------------------------------------------%0A%0A%23+Now+consider+the+following+function%3A%0A%0A%0Adef+make_play%28pet%29%3A%0A++++if+isinstance%28pet%2C+Dog%29%3A%0A++++++++pet.play%28%29%0A++++elif+isinstance%28pet%2C+Cat%29%3A%0A++++++++pet.play%28%29%0A++++else%3A%0A++++++++raise+RuntimeError%0A%0A%0Amake_play%28Dog%28%29%29%0Amake_play%28Cat%28%29%29%0A%0A%23+TODO%3A+Type-annotate+the+%60make_sound%60+function.+Is+the+case-split+here%0A%23+necessary+or+not%3F+Try+removing+the+isinstance+check+and+see+if+the+type%0A%23+checker+accepts+the+change.%0A%0A%0A%23+------------------------------------------------------------------------------%0A%0A%23+Question%3A+Is+it+possible+to+type-annotate+the+following+function+with+union%0A%23+type%2C+without+doing+any+case+split+in+the+function+body%3F+Why+or+why+not%3F%0Adef+make_chase%28pet0%2C+pet1%29%3A%0A++++pet0.chase%28pet1%29%0A++++pet1.chase%28pet0%29%0A%0A%0Amake_chase%28Dog%28%29%2C+Dog%28%29%29%0Amake_chase%28Cat%28%29%2C+Dog%28%29%29%0Amake_chase%28Dog%28%29%2C+Cat%28%29%29%0Amake_chase%28Cat%28%29%2C+Cat%28%29%29%0A
) (Non-live)

### TypeVar

- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+TODO%3A+Try+annotating+this+function%2C+using+typevar%0Adef+make_pair%28x%2C+y%29%3A%0A++++return+%28x%2C+y%29%0A%0A%0A%23+Here+are+some+tests+to+help+you+verify+that+the+annotation+above+is+working.%0A%23+The+entire+file+should+have+no+type+errors+if+you+did+it+correctly.%0Adef+verify0%28p%3A+tuple%5Bbool%2C+bool%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+verify1%28p%3A+tuple%5Bint%2C+str%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+verify2%28p%3A+tuple%5Bbytes%2C+list%5Bfloat%5D%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test_make_pair%28%29+-%3E+None%3A%0A++++verify0%28make_pair%28True%2C+False%29%29%0A++++verify1%28make_pair%281%2C+%22foo%22%29%29%0A++++verify2%28make_pair%28b%22bar%22%2C+%5B42.0%5D%29%29%0A%0A%0A%23+Question%3A+In+the+example+above%2C+how+many+type+vars+did+you+define%3F%0A
)
- [Example1](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+TODO%3A+Try+annotating+this+function%2C+using+typevar%0A%23+Hint%3A+here+are+some+example+behaviors+of+this+function%3A%0A%23+flatten_list%28%5B%5B1%5D%2C+%5B%5D%2C+%5B2%2C+3%5D%5D%29+%3D%3D+%5B1%2C+2%2C+3%5D%0A%23+flatten_list%28%5B%5B%22foo%22%2C+%22bar%22%5D%2C+%5B%22baz%22%5D%5D%29+%3D%3D+%5B%22foo%22%2C+%22bar%22%2C+%22baz%22%5D%0A%23+flatten_list%28%5B%5B%5B0%5D%2C+%5B1%5D%5D%2C+%5B%5B2%2C+3%5D%5D%5D%29+%3D%3D+%5B%5B0%2C+1%5D%2C+%5B2%2C+3%5D%5D%0Adef+flatten_list%28inputs%29%3A%0A++++return+%5Bx+for+y+in+inputs+for+x+in+y%5D%0A%0A%0A%23+Here+are+some+tests+to+help+you+verify+that+the+annotation+above+is+working.%0A%23+The+entire+file+should+have+no+type+errors+if+you+did+it+correctly.%0Adef+verify0%28l%3A+list%5Bint%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+verify1%28l%3A+list%5Bstr%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+verify2%28l%3A+list%5Blist%5Bint%5D%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test_flatten_list%28%29+-%3E+None%3A%0A++++verify0%28flatten_list%28%5B%5B1%5D%2C+%5B%5D%2C+%5B2%2C+3%5D%5D%29%29%0A++++verify1%28flatten_list%28%5B%5B%22foo%22%2C+%22bar%22%5D%2C+%5B%22baz%22%5D%5D%29%29%0A++++verify2%28flatten_list%28%5B%5B%5B0%5D%2C+%5B1%5D%5D%2C+%5B%5B2%2C+3%5D%5D%5D%29%29%0A
)
- [Example2](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0Afrom+typing+import+TypeVar%0A%0A%23+This+exercise+is+about+the+scope+of+the+typevar.%0A%0A%23+Below+we+have+2+functions%2C+%60foo%60+and+%60bar%60.+They+are+defined+with+2+different%0A%23+typevars%2C+T+and+U.%0A%0AT+%3D+TypeVar%28%22T%22%29%0A%0A%0Adef+foo%28x%3A+T%29+-%3E+list%5BT%5D%3A%0A++++...%0A%0A%0AU+%3D+TypeVar%28%22U%22%29%0A%0A%0Adef+bar%28y%3A+U%29+-%3E+U%3A%0A++++...%0A%0A%0Adef+test%28%29+-%3E+int%3A%0A++++return+bar%2842%29+%2B+len%28foo%28%22abc%22%29%29%0A%0A%0A%23+TODO%3A+Try+changing+the+definition+of+%60bar%60+such+that+it+reuses+the+same%0A%23+typevar+T+as+%60foo%60.+How+did+your+change+affect+type+checking+results%3F%0A%0A%0A%23+-----------------------------------------------------------------------------------------%0A%0A%0A%23+Now+let%27s+try+something+different.+This+time%2C+we+have+an+outer+function%0A%23+%60test%60+and+an+inner+function+%60make_tuple_inner%60.+They+are+currently+defined%0A%23+using+2+different+typevars%2C+T+and+U.%0A%0A%0Adef+test%28x%3A+T%29+-%3E+tuple%5Bint%2C+int%5D%3A%0A++++def+make_tuple_inner%28y%3A+U%2C+z%3A+U%29+-%3E+tuple%5BU%2C+U%5D%3A%0A++++++++return+%28y%2C+z%29%0A%0A++++return+make_tuple_inner%280%2C+1%29%0A%0A%0A%23+TODO%3A+Try+changing+the+definition+of+%60make_tuple_inner%60+such+that+it+reuses%0A%23+the+same+typevar+T+as+%60test%60.+How+did+your+change+affect+type+checking%0A%23+results%3F%0A%0A%0A%23+-----------------------------------------------------------------------------------------%0A%0A%0A%23+The+general+lesson+here+is+that+TypeVars+can+be+freely+reused+across%0A%23+different+functions%2C+but+they+cannot+be+freely+reused+within+the+body+of+a%0A%23+single+function.%0A
) (Non-live)
- [Example3](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+TypeVars+can+also+take+a+%22bound%22+argument.+Suppose+we+have+a+class+hierachy+like+this%3A%0A%0A%0Aclass+Pet%3A%0A++++name%3A+str%0A%0A++++def+__init__%28self%2C+name%3A+str%29+-%3E+None%3A%0A++++++++self.name+%3D+name%0A%0A%0Aclass+Dog%28Pet%29%3A%0A++++pass%0A%0A%0Aclass+Cat%28Pet%29%3A%0A++++pass%0A%0A%0A%23+And+we+have+a+function+that+is+supposed+to+operate+on+any+subclasses+of+Pet%3A%0A%0A%0Adef+make_cute%28pet%29%3A%0A++++original_name+%3D+pet.name%0A++++new_name+%3D+f%22Cute+%7Boriginal_name%7D%22%0A++++pet.name+%3D+new_name%0A++++return+pet%0A%0A%0A%23+It%27s+apparent+that+the+function+has+the+same+parameter+and+return+type%2C+so+we%0A%23+might+want+to+use+a+type+var.%0A%23+TODO%3A+Try+annotating+the+function+above+with+a+simple+typevar+and+see+what%0A%23+happens+--+why+do+you+think+the+type+checker+complains%3F%0A%0A%23+TODO%3A+Now%2C+add+a+%22bound%22+argument+to+your+typevar+like+this%3A%0A%23+T+%3D+TypeVar%28%22T%22%2C+bound%3DPet%29%0A%23+This+basically+tells+the+type+checker+that+within+the+function+body%2C+T+is%0A%23+guaranteed+to+be+a+subclass+of+Pet%2C+which+makes+it+possible+for+us+to+access%0A%23+its+%60name%60+field+within+the+function.+Try+invoking+the+function+with+an+int%0A%23+or+string+and+see+what+happens%21%0A%0A%23+Such+trick+is+often+useful%2C+for+example%2C+when+you+use+the+builder+pattern.%0A%0A%0Adef+verify_dog%28dog%3A+Dog%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+verify_cat%28cat%3A+Cat%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test%28%29+-%3E+None%3A%0A++++verify_dog%28make_cute%28Dog%28%22Fido%22%29%29%29%0A++++verify_cat%28make_cute%28Dog%28%22Fido%22%29%29%29%0A
) (Non-live)

### Overload
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+The+Python+standard+library+has+a+built-in+%22round%22+function%2C+which+takes+a%0A%23+float+value+and+round+it+down.+If+no+additional+argument+is+provided%2C+or+if%0A%23+the+ndigits+argument+is+set+to+None%2C+the+input+float+will+be+round+to+the%0A%23+nearest+integer.+Otherwise%2C+if+ndigits+is+a+integer%2C+it+specifies+the+number%0A%23+of+decimal+digits+to+keep%2C+and+the+return+value+becomes+a+float.+For+example%3A%0A%0Aassert+round%2842.06%29+%3D%3D+42%0Aassert+round%2842.06%2C+None%29+%3D%3D+42%0Aassert+round%2842.06%2C+ndigits%3DNone%29+%3D%3D+42%0Aassert+round%2842.06%2C+1%29+%3D%3D+42.1%0Aassert+round%2842.06%2C+ndigits%3D1%29+%3D%3D+42.1%0A%0A%23+The+exercise+here+is+to+try+adding+type+annotation+to+this+builtin+functions.%0A%23+To+avoid+potential+naming+conflict%2C+let%27s+write+our+own+wrapper+of+the%0A%23+%60round%60+function+and+operate+that+instead.%0A%23+TODO%3A+Type+annotate+the+%60my_round%60+function.+The+entire+file+should+have+no%0A%23+type+errors+if+you+did+it+correctly.%0A%0A%0Adef+my_round%28value%2C+ndigits%3DNone%29%3A%0A++++%23+An+error+suppression+is+needed+here+if+fallback+annotation+is+added.%0A++++return+round%28value%2C+ndigits%29++%23+type%3A+ignore%0A%0A%0A%23+Below+are+some+tests+to+help+you+verify+that+the+annotation+above+is+working.%0Adef+verify0%28r%3A+int%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+verify1%28r%3A+float%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test%28%29+-%3E+None%3A%0A++++verify0%28my_round%2842.06%29%29%0A++++verify0%28my_round%2842.06%2C+None%29%29%0A++++verify0%28my_round%2842.06%2C+ndigits%3DNone%29%29%0A++++verify1%28my_round%2842.06%2C+1%29%29%0A++++verify1%28my_round%2842.06%2C+ndigits%3D1%29%29%0A)
- [Example1](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+PEP+586+introduces+the+notion+of+%22literal+type%22+%28see%0A%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Ftyping.html%23typing.Literal%29.+A+literal+type%0A%23+is+a+type+that+can+be+used+to+indicate+to+type+checker+that+the+corresponding%0A%23+variable+can+only+take+certain+%28int%2C+boolean%2C+string%2C+or+enum%29+values.+For%0A%23+example%3A%0A%0Afrom+typing+import+Literal%0A%0A%0Adef+only_take_one%28x%3A+Literal%5B1%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Aonly_take_one%281%29++%23+OK%0A%23+only_take_one%282%29+will+error%2C+since+only+the+integer+literal+1+has+the+type%0A%23+%60Literal%5B1%5D%60.%0A%0A%0Adef+only_take_true%28x%3A+Literal%5BTrue%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Aonly_take_true%28True%29++%23+OK%0A%23+only_take_one%28False%29+will+error%2C+due+to+same+reason+before.%0A%0A%0A%23+Given+the+information+above%2C+let%27s+try+adding+type+annotation+to+the%0A%23+following+function.+It%27s+a+simple+wrapper+around+%60subprocess.run%60.+The+idea%0A%23+is+that+we+have+a+flag+to+control+whether+the+return+code+or+the+stdout+of%0A%23+the+subprocess+invocation+should+be+returned.%0A%23+TODO%3A+Type+annotate+the+%60run%60+function.+The+entire+file+should+have+no+type%0A%23+errors+if+you+did+it+correctly.%0A%0Aimport+subprocess%0A%0A%0Adef+run%28command%2C+keep_stdout%3DFalse%29%3A%0A++++%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fsubprocess.html%23subprocess.run%0A++++%23+The+code+only+works+on+Python+3.7%2B%0A++++result+%3D+subprocess.run%28%0A++++++++command.split%28%29%2C%0A++++++++text%3DTrue%2C%0A++++++++capture_output%3Dkeep_stdout%2C%0A++++%29%0A++++if+keep_stdout%3A%0A++++++++return+result.stdout%0A++++else%3A%0A++++++++return+result.returncode%0A%0A%0A%23+Below+are+some+tests+to+help+you+verify+that+the+annotation+above+is+working.%0Adef+verify0%28r%3A+int%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+verify1%28r%3A+str%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test%28%29+-%3E+None%3A%0A++++verify0%28run%28%22touch+foo.py%22%29%29%0A++++verify0%28run%28%22touch+foo.py%22%2C+keep_stdout%3DFalse%29%29%0A++++verify1%28run%28%22cat+foo.py%22%2C+keep_stdout%3DTrue%29%29%0A) (Non-live)
- [Example2](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+This+is+a+read-only+exercise.%0A%0Afrom+typing+import+overload%0A%0A%23+Using+overloads+to+annotate+functions+is+sometimes+unavoidable+because+the%0A%23+function+comes+from+a+third+party+library+you+do+not+control%2C+and+you+are%0A%23+just+writing+type+stubs+for+it.%0A%23+But+if+you+do+have+full+control+over+the+source+code+and+are+able+to+do+some%0A%23+refactoring%2C+there+are+ways+to+avoid+the+complexity+and+the+hassle+of%0A%23+overloads+altogether.%0A%0A%23+One+thing+to+realize+is+that+overloads+are+necessary+only+when+you+want%0A%23+different+function+signatures+to+share+the+same+name.+If+there%27s+no+name%0A%23+sharing%2C+no+overload+needed.+Hence+the+easiest+way+to+avoid+overloads+is+to%0A%23+break+the+overloaded+name+into+separate+functions.+Take+the+%60receive_data%60%0A%23+example+we+had+in+the+talk%3A%0A%0A%0A%40overload%0Adef+receive_data%28%29+-%3E+bytes%3A%0A++++pass%0A%0A%0A%40overload%0Adef+receive_data%28encoding%3A+None%29+-%3E+bytes%3A%0A++++pass%0A%0A%0A%40overload%0Adef+receive_data%28encoding%3A+str%29+-%3E+str%3A%0A++++pass%0A%0A%0Adef+receive_data%28encoding%3A+str+%7C+None+%3D+None%29+-%3E+bytes+%7C+str%3A%0A++++...%0A%0A%0A%23+Instead+of+having+one+function+that+may+return+either+a+bytes+or+a+string%2C%0A%23+write+two+different+functions+instead%3A%0A%0A%0Adef+receive_bytes_data%28%29+-%3E+bytes%3A%0A++++...%0A%0A%0Adef+receive_str_data%28encoding%3A+str%29+-%3E+str%3A%0A++++...%0A%0A%0A%23+Downstream+code+will+be+able+to+choose+which+one+to+use+on+their+side+based%0A%23+on+the+name+of+the+function%2C+not+on+the+number+or+the+types+of+the+arguments.%0A%23+No+overload+is+required+at+all.%0A%0A%23+The+same+thing+can+be+done+in+other+examples.+Try+thinking+of+a+way+to+break%0A%23+the+%60round%60+function+and+the+%60run%60+function+we+wrote+in+other+exercises.%0A) (Non-live)

## Topic 2: Working with classes

### Override
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+This+exercise+is+about+basic+object-oriented+programming+in+Python.%0A%23+Let%27s+define+a+simple+class+hierarchy%3A%0A%0A%0Aclass+Pet%3A%0A++++def+__init__%28self%2C+name%3A+str%29+-%3E+None%3A%0A++++++++self.name%3A+str+%3D+name%0A%0A++++def+play_with%28self%2C+other%3A+%22Pet%22%29+-%3E+None%3A%0A++++++++print%28f%22%7Bself.name%7D+is+playing+with+%7Bother.name%7D%22%29%0A%0A%0A%23+Subclasses+of+Pet+%22inherits%22+all+the+attributes+and+methods+in+the+parent%0A%23+class.+So+any+Dog+will+also+have+a+name+and+a+play_with+method.+What%E2%80%99s+more%2C%0A%23+Dog+can+also+add+new+attributes+or+new+methods+that+do+not+exist+in+the+Pet%0A%23+class.%0Aclass+Dog%28Pet%29%3A%0A++++def+bark%28self%29+-%3E+None%3A%0A++++++++print%28%22Whoof%21+Whoof%21%22%29%0A%0A%0A%23++Another+thing+that+may+happen+in+subclass+is+that+you+can+define+attributes%0A%23++or+methods+that+has+the+same+name+as+the+attributes+or+methods+in+the+parent%0A%23++class.+Doing+this+will+make+the+definition+in+the+child+class+%22override%22+the%0A%23++corresponding+definition+in+the+parent.+The+end+result+of+the+overriding+is%0A%23++that+the+%60Cat%60+objects+and+Pet+objects+may+share+the+same+%60play_with%60%0A%23++interface%2C+but+when+you+invoke+that+interface%2C+they+will+behave+differently.%0Aclass+Cat%28Pet%29%3A%0A++++def+play_with%28self%2C+other%3A+Pet%29+-%3E+None%3A%0A++++++++print%28f%22%7Bself.name%7D+does+not+want+to+play+with+%7Bother.name%7D%22%29%0A%0A%0A%23+TODO%3A+Type-annotate+the+following+functions+without+using+union+type.+The%0A%23+function+should+accepts+all+kinds+of+pets%2C+but+nothing+else.%0Adef+befriend%28pet0%2C+pet1%29%3A%0A++++pet0.play_with%28pet1%29%0A++++pet1.play_with%28pet0%29%0A%0A%0A%23+Below+are+some+tests+to+help+you+verify+that+the+annotation+above+is+working.%0A%23+The+%60test%60+function+should+have+no+type+errors+if+you+did+it+correctly.%0A%0A%0Adef+test%28%29+-%3E+None%3A%0A++++befriend%28Dog%28%22Fido%22%29%2C+Dog%28%22Rover%22%29%29%0A++++befriend%28Dog%28%22Fido%22%29%2C+Cat%28%22Fluffy%22%29%29%0A++++befriend%28Cat%28%22Fluffy%22%29%2C+Dog%28%22Fido%22%29%29%0A++++befriend%28Cat%28%22Fluffy%22%29%2C+Cat%28%22Silky%22%29%29%0A%0A%0A%23+-------------------------------------------------------------------------------%0A%0A%0A%23+Here%27s+another+class+that+tries+to+extend+Pet.+The+type+checker+complains%0A%23+about+it.+Can+you+spot+why%3F%0A%0A%0Aclass+Duck%28Pet%29%3A%0A++++def+play_with%28self%29+-%3E+None%3A%0A++++++++print%28f%22%7Bself.name%7D+is+playing+by+itself%22%29%0A%0A%0A%23+Trying+executing+this+file+with+the+Python+interpreter+%28e.g.+%60python3%0A%23+example.py%60%29+to+get+a+sense+of+why+the+definition+of+%60Duck%60+is+problematic.%0Abefriend%28Dog%28%22Fido%22%29%2C+Duck%28%22Donald%22%29%29%0A)
- [Example1](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+This+example+shows+why+it+is+not+safe+to+have+overriding+method+change+the%0A%23+return+type+to+be+more+general.+Try+run+this+file+with+a+Python+interpreter%0A%23+%28e.g.+%60python3+example1.py%60%29.%0A%0A%0Aclass+Pet%3A%0A++++def+__init__%28self%2C+name%3A+str%29+-%3E+None%3A%0A++++++++self.name%3A+str+%3D+name%0A%0A++++def+clone%28self%29+-%3E+%22Pet%22%3A%0A++++++++return+Pet%28self.name%29%0A%0A%0Aclass+Dog%28Pet%29%3A%0A++++def+clone%28self%29+-%3E+object%3A++%23+type%3A+ignore%0A++++++++return+42%0A%0A%0Adef+test%28pet%3A+Pet%29+-%3E+None%3A%0A++++clone+%3D+pet.clone%28%29%0A++++print%28f%22Name+of+cloned+pet+is+%7Bpet.name%7D%22%29%0A%0A%0Atest%28Dog%28%22Fido%22%29%29%0A) (Non-live)
- [Example2](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+This+example+shows+why+it+is+not+safe+to+have+overriding+method+change+the%0A%23+parameter+type+to+be+more+specific.+Try+run+this+file+with+a+Python%0A%23+interpreter+%28e.g.+%60python3+example2.py%60%29.%0A%0A%0Aclass+Pet%3A%0A++++def+__init__%28self%2C+name%3A+str%29+-%3E+None%3A%0A++++++++self.name%3A+str+%3D+name%0A%0A++++def+likes%28self%2C+other%3A+%22Pet%22%29+-%3E+bool%3A%0A++++++++return+True%0A%0A%0Aclass+Dog%28Pet%29%3A%0A++++pass%0A%0A%0Aclass+Cat%28Pet%29%3A%0A++++def+is_fluffy%28self%29+-%3E+bool%3A%0A++++++++return+self.name+%3D%3D+%22Fluffy%22%0A%0A++++def+likes%28self%2C+other%3A+%22Cat%22%29+-%3E+bool%3A++%23+type%3A+ignore%0A++++++++return+other.is_fluffy%28%29%0A%0A%0Adef+likes_fido%28pet%3A+Pet%29+-%3E+bool%3A%0A++++return+pet.likes%28Dog%28%22Fido%22%29%29%0A%0A%0Aprint%28likes_fido%28Cat%28%22Fluffy%22%29%29%29%0A) (Non-live)
- [Example3](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+A+%28hypothetical%29+Python+developer+is+having+trouble+with+a+typing-related%0A%23+issue.+Here+is+what+the+code+looks+like%3A%0A%0A%0Aclass+ConfigA%3A%0A++++pass%0A%0A%0Aclass+ConfigB%3A%0A++++some_attribute%3A+int+%3D+1%0A%0A%0Aclass+HelperBase%3A%0A++++def+__init__%28self%2C+config%3A+ConfigA+%7C+ConfigB%29+-%3E+None%3A%0A++++++++self.config+%3D+config%0A%0A++++def+common_fn%28self%29+-%3E+None%3A%0A++++++++pass%0A%0A%0Aclass+HelperA%28HelperBase%29%3A%0A++++def+__init__%28self%2C+config%3A+ConfigA%29+-%3E+None%3A%0A++++++++super%28%29.__init__%28config%29%0A%0A%0Aclass+HelperB%28HelperBase%29%3A%0A++++def+__init__%28self%2C+config%3A+ConfigB%29+-%3E+None%3A%0A++++++++super%28%29.__init__%28config%29%0A%0A++++def+some_fn%28self%29+-%3E+int%3A%0A++++++++return+self.config.some_attribute%0A%0A%0A%23+The+developer+is+confused+about+why+Pyre+reports+a+type+error+on+%60HelperB.some_fn%60.%0A%23+Question%3A+Is+the+reported+type+error+a+false+positive+or+not%3F%0A%23+Question%3A+How+would+you+suggest+changing+the+code+to+avoid+the+type+error%3F%0A%23+Question%3A+Is+it+a+good+idea+to+have+%60HelperA%60+and+%60HelperB%60+share+the+same+base+class%3F%0A) (Non-live)

### Protocol
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+Consider+the+following+%60read_and_process%28%29%60+function%2C+which+reads+data+from%0A%23+somewhere%2C+and+process+the+data+somehow.%0Adef+_process%28message%3A+bytes%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+read_and_process%28input_channel%29%3A%0A++++message+%3D+input_channel.readline%28%29%0A++++_process%28message%29%0A%0A%0A%23+Question%3A+without+additional+context%2C+what+do+think+should+be+the+type+of+the%0A%23+parameter+%60input_channel%60%3F%0A%0A%0A%23+----------------------------------------------------------------------------%0A%0A%0A%23+It+seems+like+%60input_channel%60+can+be+many+things.+For+examle%2C+we+could+pass%0A%23+an+opened+file+to+it%3A%0A%0A%0Adef+test_file%28filename%3A+str%29+-%3E+None%3A%0A++++%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Ffunctions.html%23open%0A++++with+open%28filename%2C+%22rb%22%29+as+f%3A%0A++++++++%23+The+type+of+%60f%60+here+would+be+%60io.BufferedReader%60.+You+can+confirm+it%0A++++++++%23+by+adding+a+%60reveal_type%28f%29%60.%0A++++++++read_and_process%28f%29%0A%0A%0A%23+We+could+also+have+the+%60input_channel%60+backed+by+a+data+stream+from+network%3A%0A%0Aimport+socket%0A%0A%0Aclass+SocketInputChannel%3A%0A++++def+__init__%28self%2C+sock%3A+socket.socket%29+-%3E+None%3A%0A++++++++self.sock+%3D+sock%0A%0A++++%23+NOTE%3A+This+is+just+a+simple+implementation+for+demonstration+purpose%0A++++%23+only.+It+is+horribly+efficient+and+therefore+not+recommended+for+any%0A++++%23+practical+purpose.+In+production+code%2C+you+may+want+to+either+leverage%0A++++%23+%60sock.makefile%28%29%60+or+to+use+an+in-memory+buffer+along+with+a+larger%0A++++%23+chunck+size+for+%60sock.recv%28%29%60%0A++++def+readline%28self%29+-%3E+bytes%3A%0A++++++++line+%3D+b%22%22%0A++++++++while+not+line.endswith%28b%22%5Cn%22%29%3A%0A++++++++++++%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fsocket.html%23socket.socket.recv%0A++++++++++++line+%2B%3D+self.sock.recv%281%29%0A++++++++return+line%0A%0A%0Adef+test_network%28sock%3A+socket.socket%29+-%3E+None%3A%0A++++read_and_process%28SocketInputChannel%28sock%29%29%0A%0A%0A%23+And+why+not+have+an+input+channel+backed+by+a+in-memory+bytes+buffer%2C+if+for%0A%23+no+other+reason+than+to+make+it+easier+to+do+unit+tests+on+the%0A%23+%60read_and_process%28%29%60+function%3F%0A%0Aimport+io%0A%0A%0Adef+test_bytes_buffer%28content%3A+bytes%29+-%3E+None%3A%0A++++%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fio.html%23io.BytesIO%0A++++read_and_process%28io.BytesIO%28content%29%29%0A%0A%0A%23+----------------------------------------------------------------------------%0A%0A%0A%23+TODO%3A+Given+all+the+usages+described+in+the+previous+section%2C+try%0A%23+type-annotating+the+%60read_and_process%28%29%60+function+appeared+on+top+of+this%0A%23+file%2C+so+all+of+its+callers+in+this+file+type+checks.%0A%0A%23+Also+think+about+the+scenario+where+in+the+future%2C+we+may+further+extend+our%0A%23+application+and+define+more+kinds+of+input+channels+%28i.e.+define+more+classes%0A%23+that+offers+a+bytes-returning+%60readline%28%29%60+method%29.+Does+the+annotation+you%0A%23+added+before+still+work%3F%0A)
- [Example1](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+TODO%3A+Try+type-annotate+the+following+function%2C+so+the+entire+file+would+type%0A%23+check.+Please+avoid+using+union+type.%0A%0A%0Adef+close_all%28%2Athings%29%3A%0A++++for+t+in+things%3A%0A++++++++t.close%28%29%0A%0A%0Aimport+tarfile%2C+threading%0A%0A%0Aclass+Resource%3A%0A++++def+__init__%28self%2C+lock%3A+threading.Lock%29+-%3E+None%3A%0A++++++++self.lock+%3D+lock%0A%0A++++def+acquire%28self%29+-%3E+None%3A%0A++++++++self.lock.acquire%28%29%0A%0A++++def+close%28self%29+-%3E+None%3A%0A++++++++self.lock.release%28%29%0A%0A%0Adef+test%28resource%3A+Resource%2C+input_filename%3A+str%2C+output_filename%3A+str%29+-%3E+None%3A%0A++++try%3A%0A++++++++resource.acquire%28%29%0A++++++++in_file+%3D+tarfile.open%28input_filename%29%0A++++++++out_file+%3D+open%28output_filename%2C+%22w%22%29%0A++++finally%3A%0A++++++++close_all%28resource%2C+in_file%2C+out_file%29%0A) (Non-live)

### Container
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+This+is+a+read-only+exercise.+Consider+the+following+class+hierarchy%3A%0A%0A%0Aclass+Pet%3A%0A++++def+__init__%28self%2C+name%3A+str%29+-%3E+None%3A%0A++++++++self.name%3A+str+%3D+name%0A%0A%0Aclass+Dog%28Pet%29%3A%0A++++def+bark%28self%29+-%3E+None%3A%0A++++++++print%28%22Whoof%21+Whoof%21%22%29%0A%0A%0Aclass+Cat%28Pet%29%3A%0A++++def+meow%28self%29+-%3E+None%3A%0A++++++++print%28%22Meow%21+Meow%21%22%29%0A%0A%0A%23+Also+consider+a+function+that+takes+a+list+of+Pet+as+argument.+The+body+of%0A%23+this+function+is+currently+kept+empty.+You+will+be+asked+to+fill+it+in+later.%0A%0A%0Adef+process_pets%28pets%3A+list%5BPet%5D%29+-%3E+None%3A%0A++++raise+NotImplementedError%0A%0A%0A%23+And+finally%2C+let%27s+have+a+test+function+that+invokes+the+%60process_pets%60+function%3A%0A%0A%0Adef+test%28%29+-%3E+None%3A%0A++++my_cats+%3D+%5BCat%28%22Fluffy%22%29%5D%0A++++process_pets%28my_cats%29%0A++++for+cat+in+my_cats%3A%0A++++++++cat.meow%28%29%0A%0A%0Atest%28%29%0A%0A%0A%23+Notice+that+the+type+checker+is+not+OK+with+this+file%3A+it+reports+a+type+error.%0A%23+Look+at+the+type+error+and+see+if+you+can+figure+out+the+rationale.%0A%23+Also+consider+what+would+happen+if+the+type+checker+accepts+the+code+as-is.%0A%0A%23+Question%3A+can+you+think+of+a+type-safe+thing+that+the+%60process_pets%28%29%60%0A%23+function+may+do%2C+which+can+lead+to+a+crash+in+the+%60test%28%29%60+function%3F+Trying%0A%23+replacing+the+body+of+%60process_pets%28%29%60+with+what+you+came+up+with%2C+and+run%0A%23+this+file+with+the+Python+interpreter+to+verify+your+thoughts.%0A)
- [Example1](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+A+%28hypothetical%29+Python+developer+is+having+some+troubles+typing+his%0A%23+code+that+are+related+to+SQL.+Here+is+the+code%3A%0A%0Afrom+datetime+import+datetime%0Afrom+typing+import+Union%0A%0ASQLTypes+%3D+Union%5BNone%2C+str%2C+bytes%2C+int%2C+float%2C+bool%2C+datetime%5D%0A%0A%0Adef+process_row%28row%3A+dict%5Bstr%2C+SQLTypes%5D%29+-%3E+None%3A%0A++++print%28row%29%0A%0A%0Adef+test%28%29+-%3E+None%3A%0A++++fred%3A+dict%5Bstr%2C+int+%7C+str+%7C+None%5D+%3D+%7B%22age%22%3A+42%2C+%22name%22%3A+%22Fred%22%2C+%22pet%22%3A+None%7D%0A++++process_row%28row%3Dfred%29%0A%0A%0A%23+The+develper+was+confused+about+the+type+error.+He+understands+that+the%0A%23+declared+row+does+not+fully+conform+to+the+SQLTypes+typing%2C+but+it%27s%0A%23+effectively+a+subset.+Why+is+this+an+incompatible+type%3F%0A%0A%23+TODO%3A+Try+to+change+one+type+annotation+in+this+file+to+resolve+the+type+error.%0A) (Non-live)

## Topic 3: Working with functions

### Callable
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+We+have+a+query+API+like+this%2C+possibly+taken+from+some+network-oriented%0A%23+library.+It+takes+the+input+of+a+query+and+two+callbacks%2C+and+invoke+the%0A%23+right+callback+depending+on+whether+the+query+has+succeeded+or+not.%0A%0A%0Adef+_do_query%28inputs%3A+str%29+-%3E+str%3A%0A++++...%0A%0A%0Adef+query%28inputs%2C+on_success%2C+on_failure%29%3A%0A++++try%3A%0A++++++++result+%3D+_do_query%28inputs%29%0A++++++++on_success%28result%29%0A++++except+Exception+as+error%3A%0A++++++++on_failure%28error%29%0A%0A%0A%23+The+API+can+be+used+as+follows%3A%0A%0A%0Adef+process_query_result%28result%3A+str%29+-%3E+None%3A%0A++++print%28f%22Query+succeeded+with+result+%3D+%7Bresult%7D%22%29%0A%0A%0Adef+log_error%28error%3A+Exception%29+-%3E+None%3A%0A++++print%28f%22Query+failed+with+error+%3D+%7Berror%7D%22%29%0A%0A%0Adef+test%28inputs%3A+str%29+-%3E+None%3A%0A++++query%28inputs%2C+on_success%3Dprocess_query_result%2C+on_failure%3Dlog_error%29%0A%0A%0A%23+TODO%3A+Please+fill+in+the+type+annotation+of+the+%60query%60+function%2C+so+the%0A%23+%60test%28%29%60+function+could+type+check.%0A)
- [Example1](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+Here+is+a+%28rather+naive%29+implementation+of+a+%22filter%22+function.+What+it+does%0A%23+is+to+take+a+predicate%2C+which+is+supposed+to+be+a+unary+function+that+returns%0A%23+a+boolean+value%2C+along+with+a+bunch+of+elements%2C+and+returns+a+list%0A%23+containing+all+elements+on+which+the+predicate+returns+true.%0A%0A%0Adef+my_filter%28predicate%2C+elements%29%3A%0A++++results+%3D+%5B%5D%0A++++for+element+in+elements%3A%0A++++++++if+predicate%28element%29%3A%0A++++++++++++results.append%28element%29%0A++++return+results%0A%0A%0A%23+A+number+of+concrete+pieces+of+logic+can+be+implemented+with+it.+For+example%2C%0A%23+this+is+a+function+that+takes+a+collection+of+numbers%2C+and+drop+all+the+ones%0A%23+in+it+that%E2%80%99s+larger+than+certain+threshold%3A%0A%0Afrom+typing+import+Iterable%0A%0A%0Adef+drop_large_numbers%28numbers%3A+Iterable%5Bint%5D%2C+limit%3A+int%29+-%3E+list%5Bint%5D%3A%0A++++return+my_filter%28lambda+x%3A+x+%3C%3D+limit%2C+numbers%29%0A%0A%0A%23+This+is+a+function+that+takes+a+directory+and+returns+all+Python+source+files%0A%23+in+that+directory%3A%0A%0Aimport+pathlib%0A%0A%0Adef+get_python_files_in_directory%28directory%3A+pathlib.Path%29+-%3E+list%5Bpathlib.Path%5D%3A%0A++++return+my_filter%28lambda+p%3A+p.suffix+%3D%3D+%22.py%22%2C+directory.iterdir%28%29%29%0A%0A%0A%23+And+this+is+a+function+that+takes+a+collection+of+employees+and+return+all%0A%23+the+ones+that+have+remained+employed+after+10+years%3A%0A%0A%0Aclass+Employee%3A%0A++++def+__init__%28self%2C+tenure%3A+int%29+-%3E+None%3A%0A++++++++self.tenure%3A+int+%3D+tenure%0A%0A%0Adef+get_senior_employees%28employees%3A+Iterable%5BEmployee%5D%29+-%3E+list%5BEmployee%5D%3A%0A++++return+my_filter%28lambda+employee%3A+employee.tenure+%3E%3D+10%2C+employees%29%0A%0A%0A%23+TODO%3A+Please+fill+in+the+type+annotation+of+the+%60my_filter%60+function%2C+so+all%0A%23+of+its+callsites+in+this+file+could+type+check.+Avoid+using+union+type+in%0A%23+your+annotation%2C+if+possible.%0A)
- [Example2](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+This+is+a+read-only+example.+It+demonstrates+some+interesting+behavior+on+the%0A%23+compatibility+of+Callable+types.%0A%0Afrom+typing+import+Callable%0A%0A%0Aclass+Pet%3A%0A++++def+__init__%28self%2C+name%3A+str%2C+age%3A+int%29+-%3E+None%3A%0A++++++++self.name+%3D+name%0A++++++++self.age+%3D+age%0A%0A%0Aclass+Dog%28Pet%29%3A%0A++++def+bark%28self%29+-%3E+None%3A%0A++++++++print%28%22Whoof%21+Whoof%21%22%29%0A%0A%0A%23+This+function+takes+a+callable+that+has+%60Pet%60+as+the+return+type.%0Adef+test0%28pet_factory%3A+Callable%5B%5B%5D%2C+Pet%5D%29+-%3E+None%3A%0A++++...%0A%0A%0A%23+This+function+is+a+callable+that+has+%60Dog%60+as+the+return+type.%0Adef+make_fido%28%29+-%3E+Dog%3A%0A++++return+Dog%28%22Fido%22%2C+2%29%0A%0A%0A%23+Question%3A+should+the+type+checker+accept+this+call%3F+Why+or+why+not%3F%0Atest0%28make_fido%29%0A%0A%23+------------------------------------------------------------------------------%0A%0A%23+This+function+takes+a+callable+that+has+%60Pet%60+as+the+parameter+type.%0Adef+test1%28predicate%3A+Callable%5B%5BPet%5D%2C+bool%5D%29+-%3E+None%3A%0A++++...%0A%0A%0A%23+This+function+is+a+callable+that+has+%60Dog%60+as+the+parameter+type.%0Adef+is_dog_happy%28dog%3A+Dog%29+-%3E+bool%3A%0A++++return+dog.age+%3C%3D+2%0A%0A%0A%23+Question%3A+should+the+type+checker+accept+this+call%3F+Why+or+why+not%3F%0Atest1%28is_dog_happy%29%0A%0A%23+------------------------------------------------------------------------------%0A%0A%0A%23+This+function+takes+a+callable+that+constructs+%60Pet%60+from+a+string+and+an+int.%0Adef+test2%28pet_factory%3A+Callable%5B%5B%5D%2C+Pet%5D%29+-%3E+None%3A%0A++++...%0A%0A%0A%23+Question%3A+should+the+type+checker+accept+this+call%3F+Why+or+why+not%3F%0Atest2%28Pet%29%0A) (Non-live)

### Callback protocol
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+In+this+exercise%2C+we+are+going+to+craft+a+simple+test+framework.%0A%0A%23+An+individual+%22test+case%22+is+a+function+that+returns+None.+If+the+function%0A%23+returns+normally%2C+we+consider+the+test+passed.+Otherwise%2C+we+consider+it%0A%23+failed.+Test+cases+are+required+to+take+one+boolean+flag+as+argument+by+our%0A%23+framework%2C+but+the+body+of+the+test+case+should+ignore+that+flag.%0A%0A%0Adef+simple_test_case_passes%28fail_fast%3A+bool%29+-%3E+None%3A%0A++++assert+1+%2B+2+%3D%3D+3%0A++++assert+%22Fido%22+%21%3D+%22Fluffy%22%0A%0A%0Adef+simple_test_case_fails%28fail_fast%3A+bool%29+-%3E+None%3A%0A++++assert+len%28%22Fido%22%29+%3D%3D+3%0A%0A%0A%23+A+%22test+suite%22+is+a+combination+of+test+cases%2C+grouped+together+so+it+just%0A%23+looks+like+one+single+test+case.+For+test+suites%2C+the+%60fail_fast%60+boolean%0A%23+flag+is+meaningful%3A+if+any+test+case+within+the+suite+fails%2C+we+abort+the%0A%23+entire+test+suite+if+%60fail_fast%60+is+set+to+True%2C+but+keep+going+if%0A%23+%60fail_fast%60+is+set+to+False.%0A%0A%0Adef+create_test_suite%28test_cases%29%3A%0A++++def+combined_test_case%28fail_fast%29%3A%0A++++++++for+test_case+in+test_cases%3A%0A++++++++++++try%3A%0A++++++++++++++++test_case%28fail_fast%3Dfail_fast%29%0A++++++++++++except+Exception%3A%0A++++++++++++++++if+fail_fast%3A%0A++++++++++++++++++++break%0A%0A++++return+combined_test_case%0A%0A%0A%23+We+also+provide+an+API+to+run+a+given+test+case%2C+while+at+the+same+time%0A%23+allowing+the+user+to+control+if+they+want+the+tests+to+fail+fast%3A%0A%0A%0Adef+run_test%28test_case%2C+fail_fast%3DFalse%29%3A%0A++++return+test_case%28fail_fast%3Dfail_fast%29%0A%0A%0A%23+TODO%3A+Please+add+type+annotations+to+the+%60create_test_suite%60+function+and+the%0A%23+%60run_test%60+function.+Below+are+code+that+helps+verify+whether+your%0A%23+annotations+work+or+not.%0A%0A%0Adef+test_case0%28fail_fast%3A+bool%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test_case1%28fail_fast%3A+bool%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test_case2%28fail_fast%3A+bool%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test_case3%28fail_fast%3A+bool%29+-%3E+None%3A%0A++++...%0A%0A%0Adef+test_all%28%29+-%3E+None%3A%0A++++run_test%28test_case0%29%0A++++run_test%28test_case1%2C+fail_fast%3DTrue%29%0A++++run_test%28create_test_suite%28%5Btest_case0%2C+test_case1%5D%29%29%0A++++run_test%28%0A++++++++create_test_suite%28%28test_case0%2C+create_test_suite%28%5Btest_case1%2C+test_case2%5D%29%29%29%0A++++%29%0A++++run_test%28%0A++++++++create_test_suite%28%0A++++++++++++%28%0A++++++++++++++++create_test_suite%28%5Btest_case0%2C+test_case1%5D%29%2C%0A++++++++++++++++create_test_suite%28%28test_case2%2C%29%29%2C%0A++++++++++++%29%0A++++++++%29%2C%0A++++++++fail_fast%3DTrue%2C%0A++++%29%0A)

### Decorator
- [Example0](https://pyre-check.org/play?input=%23+pyre-strict%0A%0A%23+TODO%3A+Try+annotating+the+decorator+below+yourself.+Try+avoid+union+types+and%0A%23+make+your+annotation+as+general+as+possible.+For+the+sake+of+simplicity%2C%0A%23+let%27s+simply+ignore+the+issue+with+keyword+arguments+for+now.+The+entire+file%0A%23+should+have+no+type+errors+if+you+did+it+correctly.%0A%0A%0Adef+my_decorator%28original_func%29%3A%0A++++def+wrapped_func%28x%29%3A%0A++++++++print%28%22Before+calling+original_func%22%29%0A++++++++result+%3D+original_func%28x%29%0A++++++++print%28%22After+calling+original_func%22%29%0A++++++++return+result%0A%0A++++return+wrapped_func%0A%0A%0A%23+Below+are+some+tests+to+help+you+verify+that+the+annotation+above+is+working.%0A%0A%0A%40my_decorator%0Adef+foo%28x%3A+int%29+-%3E+int%3A%0A++++return+x+%2B+1%0A%0A%0Afoo%2842%29%0A%0A%0A%40my_decorator%0Adef+bar%28y%3A+str%29+-%3E+list%5Bstr%5D%3A%0A++++return+%5By%2C+y%5D%0A%0A%0Abar%28%22Fluffy%22%29%0A%0A%0A%40my_decorator%0Adef+baz%28z%3A+bytes%29+-%3E+bool%3A%0A++++return+len%28z%29+%3C%3D+5%0A%0A%0Abaz%28b%22Rover%22%29%0A%0A%0Aclass+Dog%3A%0A++++def+__init__%28self%2C+name%3A+str%29+-%3E+None%3A%0A++++++++self.name+%3D+name%0A%0A%0A%40my_decorator%0Adef+qux%28name%3A+str%29+-%3E+Dog+%7C+None%3A%0A++++return+Dog%28name%29+if+name+%3D%3D+%22Fido%22+else+None%0A%0A%0Aqux%28%22Fido%22%29%0A)
- [Example1](https://pyre-check.org/play?input=%23+pyre-ignore-all-errors%0A%0A%23+TODO%3A+Change+%60pyre-ignore-all-errors%60+to+%60pyre-strict%60+on+line+1%2C+so+we+get%0A%23+to+see+all+type+errors+in+this+file.%0A%0A%23+ParamSpec+can+be+used+for+more+than+just+preserving+function+signatures.+It%0A%23+can+also+be+used+to+perform+certain+signature+transformations.+Below+is+a%0A%23+decorator+that+turns+arbitrary+async+function+into+a+sync+function+that+gets%0A%23+executed+immediately%3A%0A%0Aimport+asyncio%0Aimport+random%0A%0A%0Adef+to_sync%28func%29%3A%0A++++def+wrapper%28%2Aargs%2C+%2A%2Akwargs%29%3A%0A++++++++%23+Require+Python+3.7%0A++++++++%23+https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fasyncio-task.html%23asyncio.run%0A++++++++return+asyncio.run%28func%28%2Aargs%2C+%2A%2Akwargs%29%29%0A%0A++++return+wrapper%0A%0A%0A%23+Here+are+some+examples+on+how+this+decorator+can+be+used%3A%0A%0A%0A%40to_sync%0Aasync+def+count%28start%3A+int%2C+end%3A+int%29+-%3E+int%3A%0A++++result+%3D+0%0A++++for+i+in+range%28start%2C+end%29%3A%0A++++++++print%28f%22Counting+%7Bi%7D%22%29%0A++++++++result+%2B%3D+1%0A++++++++await+asyncio.sleep%281%29%0A++++return+result%0A%0A%0Aasync+def+sleeper%28identifier%3A+int%2C+duration%3A+float%29+-%3E+None%3A%0A++++print%28f%22Thread+%7Bidentifier%7D+goes+to+sleep+for+%7Bduration%7D+seconds...%22%29%0A++++await+asyncio.sleep%28duration%29%0A++++print%28f%22Thread+%7Bidentifier%7D+just+wakes+up.%22%29%0A%0A%0A%40to_sync%0Aasync+def+concurrent_sleepers%28count%3A+int%29+-%3E+None%3A%0A++++await+asyncio.gather%28%2A%28sleeper%28i%2C+2+%2A+random.random%28%29%29+for+i+in+range%28count%29%29%29%0A%0A%0A%23+Notice+how+we+can+now+invoke+those+async+functions+in+a+sync+context%2C+after%0A%23+applying+the+decorator.+You+can+also+run+this+file+with+the+Python%0A%23+interpreter+to+verify+that+it+works.%0Adef+test%28%29+-%3E+None%3A%0A++++print%28count%281%2C+3%29%29%0A++++print%28count%284%2C+6%29%29%0A++++concurrent_sleepers%282%29%0A++++concurrent_sleepers%283%29%0A%0A%0Atest%28%29%0A%0A%23+TODO%3A+Your+exercise+is+to+add+type+annotations+to+the+%60to_sync%60+decorator%0A%23+using+%60ParamSpec%60.+If+you+did+it+correctly%2C+the+entire+file+should+type%0A%23+check.%0A%23+For+your+information%2C+async+functions+can+generally+be+typed+with+%60Callable%60s%0A%23+in+the+same+way+as+normal+functions%2C+except+that+the+return+type+needs+to+be%0A%23+wrapped+in+an+%60Awaitable%60.+For+example%3A%0A%0Afrom+typing+import+Callable%2C+Awaitable%0A%0A%0Aasync+def+f%28x%3A+int%29+-%3E+str%3A%0A++++...%0A%0A%0Adef+take_async%28g%3A+Callable%5B%5Bint%5D%2C+Awaitable%5Bstr%5D%5D%29+-%3E+None%3A%0A++++...%0A%0A%0Atake_async%28f%29++%23+This+should+type+check%0A)
- [Example2](https://github.com/fbsamples/python-typing-tutorial/blob/main/typing_pattern_exercises/topic3/decorator/example2.py) (Non-live) (Command-line only since too large for pyre playground)
